import jwt, { JwtPayload } from 'jsonwebtoken';
import { TokenPayload } from '@/interfaces/jwtPayload.interfaces';
import { env } from '@/env';
import {
  accessTokenExpiresIn,
  recoverSessionExpiresIn,
  refreshTokenExpiresIn,
} from '@/const';

const JwtUtils = {
  generateAccessToken: (payload: TokenPayload | null): string => {
    if (!payload) {
      throw new Error('Generate AccessToken Payload Cant Be Null');
    }
    return jwt.sign(payload, env.JWT_ACCESS_TOKEN_SECRET_KEY as string, {
      expiresIn: accessTokenExpiresIn,
    });
  },
  generateRefreshToken: (payload: TokenPayload): string => {
    if (!payload) {
      throw new Error('Generate RefreshToken Payload Cant Be Null');
    }
    return jwt.sign(payload, env.JWT_REFRESH_TOKEN_SECRET_KEY, {
      expiresIn: refreshTokenExpiresIn,
    });
  },
  generateRecoverToken: (payload: TokenPayload | null): string => {
    if (!payload) {
      throw new Error('Generate RecoverToken Payload Cant Be Null');
    }
    return jwt.sign(payload, env.JWT_RECOVER_SESSION_TOKEN_SECRET_KEY, {
      expiresIn: recoverSessionExpiresIn,
    });
  },
  verifyAccessToken: (token: string | null): JwtPayload => {
    if (!token) {
      throw new Error('Access Token Is Missing');
    }
    return jwt.verify(token, env.JWT_ACCESS_TOKEN_SECRET_KEY) as JwtPayload;
  },
  verifyRefreshToken: (token: string): JwtPayload => {
    if (!token) {
      throw new Error('Refresh Token Is Missing');
    }
    return jwt.verify(token, env.JWT_REFRESH_TOKEN_SECRET_KEY) as JwtPayload;
  },

  verifyRecoverToken: (token: string): JwtPayload | null => {
    if (!token) {
      throw new Error('Recover Token Is Missing');
    }
    return jwt.verify(
      token,
      env.JWT_RECOVER_SESSION_TOKEN_SECRET_KEY
    ) as JwtPayload;
  },
};

export default JwtUtils;
